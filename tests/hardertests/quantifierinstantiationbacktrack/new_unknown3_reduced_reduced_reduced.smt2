(declare-sort % 0)
(declare-sort P 0)
(declare-fun I (Int) P)
(declare-fun % (P) Int)
(declare-sort T 0)
(declare-sort D 0)
(declare-const $ D)
(declare-fun h (P T) Bool)
(declare-fun e (T P P) Bool)
(declare-sort vs 0)
(declare-datatypes ((b 0) (b! 0)) (((ib! (lib! vs) (t vs) (s2 Int))) ((!e (b!e Int))))) ; I think the fact taht this is an Int type matters!
(declare-fun l (b) vs)
(declare-fun b! (b!) Int)
(declare-fun b (b!) Int)
(declare-fun li (b!) Int)
(declare-fun Y (D T D T) T)
(declare-fun T () T)
(declare-const YP T)
(declare-const E T)
(declare-fun P (%) P)
(declare-fun o (vs) P)
(declare-fun %P (P) vs)
(declare-fun Po (b) P)
(declare-fun %Po (P) b)
(declare-fun ol (b!) P)
(declare-fun Pol (P) b!)
(assert (forall ((x P)) (! (= x (o (%P x))) :pattern ((h x T)))))
(assert (forall ((x b)) (! (= x (%Po (Po x))) :pattern ((Po x)))))
(assert (forall ((o vs) (r vs) (a Int)) (! (or (h (Po (ib! r r a)) YP)) :pattern ((Po (ib! o r a))))))
(declare-fun v (P) P)
(declare-fun vs (D T D T P) P)
(declare-fun ib (P) Int)
(declare-fun lib (P P P) vs)
(declare-fun i (P) Bool)
(assert (forall ((& D) (A T) (. D) (F T) (f P)) (! (or (h (vs . YP . F f) T)) :pattern ((vs & A . F f)))))
(declare-fun %% (Int Int Int) %)
(assert (forall ((a P) (t P) (e P)) (! (= (lib a t e) (%P (vs $ YP $ (Y $ YP $ YP) (P (%% (ib t) (ib t) (ib t)))))) :pattern ((lib a t e)))))
(assert (forall ((s P)) (! (= (v s) (Po (ib! (%P (o (lib (I 0) (I (b! (Pol s))) (I (b (Pol s)))))) (%P (o (lib (I 0) (I (b! (Pol s))) (I (b (Pol s)))))) (% (I (b! (Pol s))))))) :pattern ((v s)))))
(assert (forall ((s P)) (! (= (li (Pol s)) (ib (I 0))) :pattern ((i s)))))
(declare-const s b!)
(declare-const se b!)
(assert (= (b! (Pol (ol s))) (b! (Pol (ol s)))))
(assert (not (e T (o (l (%Po (v (ol s))))) (o (l (%Po (ol se)))))))
(assert (or (i (ol se))))
(assert (not (h (o (l (%Po (v (ol se))))) T)))
(assert (= (l (%Po (v (ol se)))) (lib! (%Po (v (ol se))))))

(assert (= (o (l (%Po (v (ol se))))) (o (%P (o (l (%Po (v (ol se)))))))))
;(assert (= (v (ol s)) (Po (ib! (%P (o (lib (I 0) (I (b! (Pol (ol s)))) (I (b (Pol (ol s))))))) (%P (o (lib (I 0) (I (b! (Pol (ol s)))) (I (b (Pol (ol s))))))) (% (I (b! (Pol (ol s)))))))))
;(assert (= (li (Pol (ol se))) (ib (I 0))))
;(assert (= (ib! (%P (o (lib (I 0) (I (b! (Pol (ol s)))) (I (b (Pol (ol s))))))) (%P (o (lib (I 0) (I (b! (Pol (ol s)))) (I (b (Pol (ol s))))))) (% (I (b! (Pol (ol s)))))) (%Po (Po (ib! (%P (o (lib (I 0) (I (b! (Pol (ol s)))) (I (b (Pol (ol s))))))) (%P (o (lib (I 0) (I (b! (Pol (ol s)))) (I (b (Pol (ol s))))))) (% (I (b! (Pol (ol s))))))))))
;(assert (or (h (Po (ib! (%P (o (lib (I 0) (I (b! (Pol (ol s)))) (I (b (Pol (ol s))))))) (%P (o (lib (I 0) (I (b! (Pol (ol s)))) (I (b (Pol (ol s))))))) (% (I (b! (Pol (ol s))))))) YP)))
;(assert (= (lib (I 0) (I (b! (Pol (ol s)))) (I (b (Pol (ol s))))) (%P (vs $ YP $ (Y $ YP $ YP) (P (%% (ib (I (b! (Pol (ol s))))) (ib (I (b! (Pol (ol s))))) (ib (I (b! (Pol (ol s)))))))))))
;(assert (= (v (ol se)) (Po (ib! (%P (o (lib (I 0) (I (b! (Pol (ol se)))) (I (b (Pol (ol se))))))) (%P (o (lib (I 0) (I (b! (Pol (ol se)))) (I (b (Pol (ol se))))))) (% (I (b! (Pol (ol se)))))))))
;(assert (or (h (Po (ib! (t (%Po (v (ol s)))) (t (%Po (v (ol s)))) (s2 (%Po (v (ol s)))))) YP)))
;(assert (or (h (vs $ YP $ (Y $ YP $ YP) (P (%% (ib (I (b! (Pol (ol s))))) (ib (I (b! (Pol (ol s))))) (ib (I (b! (Pol (ol s)))))))) (T $ YP))))
;(assert (= (vs $ YP $ (Y $ YP $ YP) (P (%% (ib (I (b! (Pol (ol s))))) (ib (I (b! (Pol (ol s))))) (ib (I (b! (Pol (ol s)))))))) (o (%P (vs $ YP $ (Y $ YP $ YP) (P (%% (ib (I (b! (Pol (ol s))))) (ib (I (b! (Pol (ol s))))) (ib (I (b! (Pol (ol s))))))))))))

(check-sat)
